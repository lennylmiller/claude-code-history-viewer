# cargo-nextest configuration
# High-performance test runner for Rust
# Install: cargo install cargo-nextest --locked
# Run: cargo nextest run

[store]
# Cache test binaries for faster subsequent runs
dir = "target/nextest"

[profile.default]
# Number of retries for flaky tests
retries = 2

# Fail fast - stop on first failure
fail-fast = true

# Test timeout
slow-timeout = { period = "60s", terminate-after = 2 }

# Output settings
failure-output = "immediate-final"
success-output = "never"
status-level = "pass"
final-status-level = "fail"

# Test threads (use all CPU cores)
test-threads = "num-cpus"

[profile.ci]
# CI-specific profile
retries = 3
fail-fast = false
slow-timeout = { period = "120s", terminate-after = 3 }

# Archive settings for CI caching
[profile.ci.junit]
path = "target/nextest/ci/junit.xml"

[profile.coverage]
# Profile for coverage runs
retries = 0
fail-fast = true
slow-timeout = { period = "300s", terminate-after = 1 }

[profile.quick]
# Quick iteration profile
retries = 0
fail-fast = true
test-threads = "num-cpus"

# Test groups for parallel execution optimization
[[profile.default.overrides]]
filter = "test(::slow::)"
threads-required = 1
slow-timeout = { period = "300s", terminate-after = 1 }

[[profile.default.overrides]]
filter = "test(::integration::)"
threads-required = 2

# Platform-specific settings
[profile.default.target.'cfg(target_os = "macos")']
# macOS-specific timeouts
slow-timeout = { period = "90s", terminate-after = 2 }
